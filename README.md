# ğŸ“Š SQL RFM Segmentation & Sales Analysis

This repository contains a complete **RFM (Recency, Frequency, Monetary) Segmentation** and **Business Analysis** project implemented using **SQL**. The goal of this project is to analyze customer behavior, segment customers based on purchasing patterns, and derive actionable business insights from sales data.

---

## ğŸš€ Project Overview

RFM analysis is a proven customer segmentation technique widely used in **marketing analytics**, **CRM**, and **business intelligence**. In this project, we:

* Build RFM metrics directly from transactional sales data
* Assign RFM scores using SQL window functions
* Segment customers into meaningful business groups
* Perform additional **sales, customer, and order analysis**

The project is designed to be **database-driven**, scalable, and ready for integration with BI tools like **Power BI** or **Tableau**.

---

## ğŸ—‚ï¸ Dataset Description

**Table Used:** `SAMPLE_RFM`

### Key Columns

* `CUSTOMERNAME` â€“ Unique customer identifier
* `ORDERNUMBER` â€“ Unique order ID
* `ORDERDATE` â€“ Date of purchase (DD/MM/YY format)
* `SALES` â€“ Revenue generated per line item
* `QUANTITYORDERED` â€“ Units sold
* `PRICEEACH` â€“ Selling price per unit
* `MSRP` â€“ Manufacturerâ€™s suggested retail price
* `PRODUCTLINE` â€“ Product category
* `STATUS` â€“ Order status (Shipped, Cancelled, etc.)
* `COUNTRY` â€“ Customer location
* `YEAR_ID`, `QTR_ID`, `MONTH_ID` â€“ Time dimensions

---

## ğŸ› ï¸ Tech Stack

* **Database:** MySQL
* **Language:** SQL
* **Techniques:**

  * CTEs (Common Table Expressions)
  * Window Functions (`NTILE`, `RANK`)
  * Views
  * Aggregations & Statistical Analysis

---

## ğŸ§  RFM Methodology

### 1ï¸âƒ£ RFM Metrics

| Metric        | Description                             |
| ------------- | --------------------------------------- |
| **Recency**   | Days since the customerâ€™s last purchase |
| **Frequency** | Number of distinct orders               |
| **Monetary**  | Total revenue generated by the customer |

Recency is calculated relative to the **latest order date** in the dataset.

---

### 2ï¸âƒ£ RFM Scoring

Each RFM metric is scored from **1 to 5** using `NTILE(5)`:

* **R Score:** Higher score = more recent purchase
* **F Score:** Higher score = more frequent purchases
* **M Score:** Higher score = higher spend

An **RFM combination** (e.g., `555`, `445`) and **Total Score** are generated for each customer.

---

### 3ï¸âƒ£ Customer Segments

Customers are classified into business-friendly segments:

* **Champions**
* **Loyal Customers**
* **Potential Loyalists**
* **Promising Customers**
* **Needs Attention**
* **Canâ€™t Lose Them**
* **New Customers**
* **At Risk**
* **About to Sleep**
* **Lost Customers**

This segmentation enables targeted marketing and retention strategies.

---

## ğŸ“ˆ RFM Output View

A reusable SQL view is created and can be queried like a table.

```sql
SELECT * FROM RFM_VIEW;
```

---

## ğŸ§¾ Materialized Output Tables (Ready-to-View)

To **see physical table outputs** (not just views) and make results reusable for BI tools or exports, run the following SQL.

### 1ï¸âƒ£ Customer-Level RFM Table

```sql
CREATE TABLE RFM_CUSTOMER_OUTPUT AS
SELECT
  CUSTOMERNAME,
  RECENCY_VALUE,
  FREQUENCY_VALUE,
  MONETARY_VALUE,
  R_SCORE,
  F_SCORE,
  M_SCORE,
  TOTAL_SCORE,
  RFM_COMBINATION,
  RFM_SEGMENTS
FROM RFM_VIEW;

SELECT * FROM RFM_CUSTOMER_OUTPUT;
```

---

### 2ï¸âƒ£ RFM Segment Summary Table

```sql
CREATE TABLE RFM_SEGMENT_SUMMARY AS
SELECT
  RFM_SEGMENTS,
  COUNT(*) AS NUMBER_OF_CUSTOMERS,
  ROUND(AVG(RECENCY_VALUE),0) AS AVG_INACTIVITY_DAYS,
  ROUND(AVG(FREQUENCY_VALUE),1) AS AVG_FREQUENCY,
  ROUND(AVG(MONETARY_VALUE),0) AS AVG_SPEND
FROM RFM_VIEW
GROUP BY RFM_SEGMENTS;

SELECT * FROM RFM_SEGMENT_SUMMARY;
```

---

### 3ï¸âƒ£ Product Line Sales Output Table

```sql
CREATE TABLE PRODUCTLINE_SALES AS
SELECT
  PRODUCTLINE,
  ROUND(SUM(SALES),0) AS TOTAL_SALES
FROM SAMPLE_RFM
GROUP BY PRODUCTLINE
ORDER BY TOTAL_SALES DESC;

SELECT * FROM PRODUCTLINE_SALES;
```

---

### 4ï¸âƒ£ Monthly Sales Trend Table

```sql
CREATE TABLE MONTHLY_SALES_TREND AS
SELECT
  YEAR_ID,
  QTR_ID,
  MONTH_ID,
  ROUND(SUM(SALES),0) AS TOTAL_SALES
FROM SAMPLE_RFM
GROUP BY YEAR_ID, QTR_ID, MONTH_ID
ORDER BY YEAR_ID, MONTH_ID;

SELECT * FROM MONTHLY_SALES_TREND;
```

---

### 5ï¸âƒ£ Top Customers by Revenue Table

```sql
CREATE TABLE TOP_CUSTOMERS AS
SELECT
  CUSTOMERNAME,
  MONETARY_VALUE AS TOTAL_SALES
FROM RFM_VIEW
ORDER BY MONETARY_VALUE DESC
LIMIT 10;

SELECT * FROM TOP_CUSTOMERS;
```

---

### 6ï¸âƒ£ VIP / High-Value Customers Table (Outlier Detection)

```sql
CREATE TABLE VIP_CUSTOMERS AS
SELECT
  CUSTOMERNAME,
  MONETARY_VALUE AS SALES
FROM RFM_VIEW
WHERE MONETARY_VALUE > (
  SELECT AVG(MONETARY_VALUE) + 2 * STDDEV(MONETARY_VALUE)
  FROM RFM_VIEW
);

SELECT * FROM VIP_CUSTOMERS;
```

---

### 7ï¸âƒ£ Order Status Summary Table

```sql
CREATE TABLE ORDER_STATUS_SUMMARY AS
SELECT
  STATUS,
  COUNT(ORDERNUMBER) AS TOTAL_ORDERS
FROM SAMPLE_RFM
GROUP BY STATUS
ORDER BY TOTAL_ORDERS DESC;

SELECT * FROM ORDER_STATUS_SUMMARY;
```

---

## ğŸ“¤ Export Ready

All tables above can be directly:

* Connected to **Power BI / Tableau**
* Exported to **CSV**
* Used for **dashboarding & reporting**

This makes the project fully **end-to-end & production-ready**.

---

## ğŸ“Š Analysis Performed

### ğŸ”¹ RFM Summary Analysis

* Number of customers per segment
* Average inactivity (recency)
* Average frequency
* Average spend per segment

---

### ğŸ”¹ Sales Analysis

* Highest revenue-generating product lines
* Total sales by year, quarter, and month
* Products with highest profit margins
* Orders contributing most to total revenue

---

### ğŸ”¹ Customer Analysis

* Top 10 customers by total spend
* Average deal size per customer
* Countries generating the highest revenue
* Identification of VIP / outlier customers

---

### ğŸ”¹ Order Analysis

* Orders by status (Shipped, Cancelled, etc.)
* Monthly order volume trends
* Average quantity per order

---

## ğŸ¯ Key Business Insights

* **Classic Cars** generate the highest overall sales
* **November** has the highest order volume
* A small group of customers contributes disproportionately to revenue
* Clear identification of **VIP** and **at-risk** customers

---

## ğŸ“Œ How to Use

1. Import the dataset into MySQL
2. Run the SQL script in order
3. Query the `RFM_VIEW` for insights
4. Connect the view to Power BI / Tableau for visualization

---

## ğŸ”® Future Enhancements

* Automate RFM refresh using scheduled jobs
* Add Customer Lifetime Value (CLV)
* Build Power BI dashboards
* Apply cohort analysis

---

## ğŸ‘¤ Author

**Tanjib Sadat**
Data Analyst | SQL | Power BI | Excel

If you find this project useful, â­ star the repository!

---

## ğŸ“„ License

This project is open-source and available for educational and portfolio use.
